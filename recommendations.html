<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Top 5 Buy Recommendations</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body class="bg-light">
<div class="container py-5">
  <h1 class="mb-4">Top 5 Buy Recommendations</h1>

  {% if picks %}
    <ul class="list-group mb-4">
      {% for pick in picks %}
        <li class="list-group-item">
          <h5>{{ pick['Ticker'] }} â€” Score: {{ pick['Score'] }}</h5>
          <p>
            Price: {{ pick['Price'] }} |
            RSI: {{ pick['RSI'] }} |
            P/E: {{ pick['P/E Ratio'] }} |
            EPS: {{ pick['EPS'] }} |
            Sentiment: {{ pick['Overall Sentiment'] }} |
            Recommendation: {{ pick['Recommendation'] }}
          </p>
        </li>
      {% endfor %}
    </ul>

    <h4>Sentiment Comparison</h4>
    <div id="sentimentChart"></div>

    <script>
      const picks = {{ picks | tojson }};
      const tickers = picks.map(p => p["Ticker"]);
      const newsScores = picks.map(p => p["News Sentiment Score"]);
      const redditScores = picks.map(p => p["Reddit Sentiment Score"]);
      const twitterScores = picks.map(p => p["Twitter Sentiment Score"]);

      const traceNews = {
        x: tickers,
        y: newsScores,
        name: 'News',
        type: 'bar'
      };

      const traceReddit = {
        x: tickers,
        y: redditScores,
        name: 'Reddit',
        type: 'bar'
      };

      const traceTwitter = {
        x: tickers,
        y: twitterScores,
        name: 'Twitter',
        type: 'bar'
      };

      const layout = {
        barmode: 'group',
        title: 'Sentiment Scores by Source',
        yaxis: { title: 'Polarity Score (-1 to 1)', range: [-1, 1] },
        xaxis: { title: 'Ticker' }
      };

      Plotly.newPlot('sentimentChart', [traceNews, traceReddit, traceTwitter], layout);
    </script>
  {% else %}
    <div class="alert alert-warning">No strong buy recommendations found.</div>
  {% endif %}
</div>
</body>
</html>
